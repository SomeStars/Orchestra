<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Edit Profile</title>
    <link rel="stylesheet" th:href="@{/style.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>

    <script>
        document.getElementById("providerForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent the default form submission

            const form = event.target;
            const formData = new FormData(form);

            // Send the form data with the PUT method using fetch API
            fetch(form.action, {
                method: 'PUT', // Explicitly set the method to PUT
                body: formData // Attach the form data
            })
                .then(response => {
                    if (response.ok) {
                        // Handle successful response
                        console.log('Provider updated successfully!');
                        window.location.href = '/edit-profile'; // Redirect to the appropriate page

                    } else {
                        // Handle error response
                        console.error('Failed to update provider');
                    }
                })
                .catch(error => {
                    console.error('Error updating provider:', error);
                });
        });

    </script>

</head>
<body>

<section id="Profile">
    <div class="row">
        <div class="col-md-6 mx-auto">
            <h1 class="title text-center" th:text="${provider.username}"></h1>
            <form id="providerForm" th:action="@{/profile/update/{provider_id}(provider_id=${provider.provider_id})}" method="post">
                <!-- Bio Section -->
                <div class="comments">
                    <h1>Bio</h1>
                    <textarea id="BioTextarea" name="bio" rows="10" cols="70" th:text="${provider.bio}"></textarea>
                    <br><br>
                </div>

                <!-- Payment URL Section -->
                <div class="comments">
                    <h1>Payment URL</h1>
                    <textarea id="PaymentUrlTextarea" name="payment_url" rows="1" cols="70" th:text="${provider.paymentUrl}"></textarea>
                    <br><br>
                </div>

                <input type="hidden" name="provider_id" th:value="${provider.provider_id}">
                <button type="submit">Update</button>
            </form>

        </div>
    </div>


</section>

</body>
</html>